<div class="container mt-5 px-1 py-2">
  <%= render 'layouts/errors', obj: @post %>
  <h2 class="text-center mb-4">投稿編集</h2>
  <hr class="heading-line mb-4">
  <%= form_with(model: @post, url: post_path(@post), method: :patch, local: true, html: { multipart: true }) do |f| %>
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="bg-orange p-4 rounded shadow">
          <div class="form-edit">
            <div class="form-group">
              <%= f.label :image, "画像" %>
              <div class="custom-file mb-3">
                <%= f.file_field :image, class: "custom-file-input", id: "customFile" %>
                <label class="custom-file-label" for="customFile" id="fileLabel">ファイルを選択してください</label>
              </div>
              <div id="imagePreview" class="mt-2">
                <% if @post.image.attached? %>
                  <img src="<%= url_for(@post.image) %>" class="img-fluid" alt="Image Preview">
                <% else %>
                  <%= image_tag 'no_image.png', class: 'img-fluid', alt: 'No Image' %>
                <% end %>
              </div>
            </div>
            <div class="form-group">
              <%= f.label :title, "タイトル" %>
              <%= f.text_field :title, placeholder: "タイトル", class: "form-control" %>
            </div>
            <div class="form-group">
              <%= f.label :introduction, "内容" %>
              <%= f.text_area :introduction, placeholder: "ここに内容を記述します", rows: 5, class: "form-control" %>
            </div>
            <div class="form-group">
              <%= f.label :genre_id, "ジャンル", class: "form-label" %>
              <%= f.collection_select :genre_id, Genre.all, :id, :name, { prompt: "選択してください" }, class: "form-control" %>
              <%= f.text_field :new_genre_name, placeholder: "新しいジャンルを入力", class: "form-control" %>
              <small class="text-muted">（上記でジャンル選択していても新しくジャンルを入力した場合、入力したジャンルが優先されます。）</small>
            </div>
            <div class="text-center">
              <%= f.submit "更新する", class: "btn btn-primary mr-2" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<script>
  // JavaScript to preview the selected image
  document.getElementById("customFile").addEventListener("change", function() {
    const fileInput = this;
    const fileLabel = document.getElementById("fileLabel");
    const imagePreview = document.getElementById("imagePreview");

    if (fileInput.files && fileInput.files[0]) {
      const reader = new FileReader();

      reader.onload = function(e) {
        imagePreview.innerHTML = "<img src='" + e.target.result + "' class='img-fluid' alt='Image Preview'>";
        fileLabel.innerHTML = fileInput.files[0].name;
      }

      reader.readAsDataURL(fileInput.files[0]);
    } else {
      imagePreview.innerHTML = "<img src='/path/to/no_image.png' class='img-fluid' alt='No Image'>";
      fileLabel.innerHTML = "ファイルを選択してください";
    }
  });
</script>
