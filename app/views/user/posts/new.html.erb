<div class="container mt-5 px-1 py-2">
  <%= render 'layouts/errors', obj: @post %>
  <h2 class="text-center mb-4">新規投稿</h2>
  <hr class="heading-line mb-4">
  <%= form_with model: @post, local: true do |f| %>
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6"> 
        <div class="form-container p-4 rounded shadow">
          <div class="form-new">
            <div class="form-group">
              <%= f.label :image, "画像" %>
              <div class="custom-file mb-3">
                <%= f.file_field :image, class: "custom-file-input", id: "customFile" %>
                <label class="custom-file-label" for="customFile" id="fileLabel">ファイルを選択してください</label>
              </div>
              <div id="imagePreview" class="mt-2"></div>
            </div>

            <div class="form-group">
              <%= f.label :title, "タイトル" %>
              <%= f.text_field :title, placeholder: "タイトル", class: "form-control" %>
            </div>

            <div class="form-group">
              <%= f.label :introduction, "内容" %>
              <%= f.text_area :introduction, placeholder: "ここに内容を記述します", rows: 5, class: "form-control" %>
            </div>

            <div class="form-group">
              <%= f.label :genre_id, "ジャンル" %>
              <%= f.collection_select :genre_id, Genre.all, :id, :name, { prompt: "選択して下さい（無い場合は下に入力してください）" }, class: "form-control" %>
              <%= f.text_field :new_genre_name, placeholder: "新しいジャンルを入力してください", class: "form-control mt-2" %>
            </div>

            <%= f.submit "新規登録", class: "btn btn-block btn-primary mt-3" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="mt-5"></div>
</div>

<script>
  // JavaScript  選択した画像をプレビュー
  document.getElementById("customFile").addEventListener("change", function() {
    const fileInput = this;
    const fileLabel = document.getElementById("fileLabel");
    const imagePreview = document.getElementById("imagePreview");

    if (fileInput.files && fileInput.files[0]) {
      const reader = new FileReader();

      reader.onload = function(e) {
        imagePreview.innerHTML = "<img src='" + e.target.result + "' class='img-fluid' alt='Image Preview'>";
        fileLabel.innerHTML = fileInput.files[0].name;
      }

      reader.readAsDataURL(fileInput.files[0]);
    } else {
      imagePreview.innerHTML = "";
      fileLabel.innerHTML = "アップロードするファイルを選択してください";
    }
  });
</script>

